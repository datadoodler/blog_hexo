---
title: "How can the data for a game be obtained and neatened?"
author: "Josh Merrell"
date: "April 7, 2016"
commments: true
tags: 
- R Packages
- Analytics
- Chess
categories: 
- R Packages
---


I built this package for compatibility with [chess.com](https://www.chess.com/), so contact me if you want me to use it for other sources. Everything required for this demo can be found in [my chessDoodles workspace](https://github.com/brantmerrell/chessdoodles/blob/master/chessDoodles.RData)

```{r}

# clear workspace
rm(list=ls())

# load workspace
load("chessDoodles.RData")
```

A link to a chess.com game always ends with a game ID. Here are two examples:
 - [https://www.chess.com/echess/game?id=127609996](https://www.chess.com/echess/game?id=127609996)
 - [https://www.chess.com/echess/game?id=131764454](https://www.chess.com/echess/game?id=131764454)

So the ID of the game to assess can be used to construct the link to the game.

```{r}
linkIDs <- c(127609996, 131764454)

Links <- paste("chess.com/echess/game?id=",
               linkIDs,
               sep = "")
Links
```

These games can be viewed publicly, but scraping the [pgn](https://en.wikipedia.org/wiki/Portable_Game_Notation) for each requires a username and password. I think it's easiest to embed the password into the link with the format *"http://username:password@chess.com/..."*.

```{r}
# store username and password
Username <- "thinkboolean"
Password <- "blogChess" # counting on you not to abuse this; feel free to contact me for details

# finish constructing links
Links <- paste("http://",
               Username,
               ":",
               Password,
               "@",
               Links, 
               sep = "")
Links
```

The *rawToTidy* function scrapes the title and pgn of a chessLink.

```{r}
games <- rawToTidy(Links[1])
for(Link in Links[-1]){
  games <- rbind(games, rawToTidy(Link))
}
games
```

This provides a data frame in which each row is a game. The *tidyToPgn* function can split a game into a move-by-move data frame. 

```{r}
# first game:
moves <- tidyToPgn(tidyDF = games, n=1)

# other games:
for(n in 2:length(games)){
  moves <- rbind(moves, tidyToPgn(tidyDF = games, n = n))
}
head(moves)
tail(moves)
```

It avoids ambiguity between white and black moves by giving white moves a single dot, ".", and black moves three dots, "...".